(function(k,m,n){function r(a){return"undefined"==typeof a}function q(a){return"function"==typeof a}function y(){w=!0;k(n).resize(function(){if(!(1>s.length)){var a,b,c;for(a=0;a<s.length;a++)b=s[a],c=b._panel,b=f.panelPosition(b,c,f.options(b)),c.css({left:b.x,top:b.y})}});k(m).click(function(a){a=k(a.srcElement?a.srcElement:a.target);var b;a.hasClass(g.panel)||(a.hasClass(g.select)||a.hasClass(g.tab))||(a=a.parent(),a.hasClass(g.select)||a.hasClass(g.tab)||(a=a.parent().parent(),a.hasClass(g.panel)&&
(b=m.getElementById(a.attr("id").slice(0,-5)))&&b&&"undefined"!=typeof b._multiple&&b._multiple||f.hideAll()))}).keyup(function(a){a||(a=n.event);27==(a.keyCode?a.keyCode:a.which)&&f.hideAll()});k("body:first").append('<div class="'+g.shadow+'" id="__'+g.select+'_shadow" style="display:none">&nbsp;</div>');v=k("#__"+g.select+"_shadow")}var z=!!n.ActiveXObject&&!n.XMLHttpRequest,l={multipleJointer:"|^|",speed:"fast",shadow:!1},g={select:"vselect",linkOn:"vselect-link-on",panel:"vselect-panel",shadow:"vselect-shadow",
tab:"vselect-panel-tab",tabOn:"vselect-panel-tab-on",tabHover:"vselect-panel-tab-hover"},x={selectedValue:null,grouplessLabel:"\u5176\u4ed6",direction:"center",styleString:null,width:null,maxHeight:320,maxColumn:5,maxTop:0},u=1,v=null,s=[],w=!1,f={init:function(a){w||y();a=a||{};for(var b in x)"undefined"==typeof a[b]&&(a[b]=x[b]);return this.each(function(){f.selectInit.call(this,a)})},selectInit:function(a){var b,c,d,e;if(this.name||this.id)e=k(this).val(),d=0<k(this).find("optgroup").length,c=
f._createDom(this,a,d),b=c[0],b._options=a,b._panel=k("#__"+g.select+(u-1)+"panel"),b._value=c.find("input:first"),b._caption=c.find("em:first"),0<a.width&&c.css("width",a.width),b._selectWidth=c.width(),b._group=d,b._multiple=this.multiple,b._initSelectedIndex=this.options.selectedIndex,b._origMaxHeight=a.maxHeight,b._column=1,d?(b._tab=b._panel.find("div."+g.tab+":first"),f.panelInitWithOptgroup(b,b._panel,a),f.panelArrangeWithOptgroup(b,b._panel,a)):(f.panelInit(b,b._panel,a),f.panelArrange(b,
b._panel,a)),c.click(f.selectClick),k(this).remove(),f.setValue.call(b,null===a.selectedValue?e:a.selectedValue)},panelInit:function(a,b,c){c=k(b).find("a");for(b=0;b<c.length;b++)r(c[b].getAttribute("rel"))||(c[b].onclick=function(b){f.itemClick.call(a,b,this.getAttribute("rel"))})},panelArrange:function(a,b,c){var d=f.borderSize(b),d=k(a).outerWidth()-d.width,e=1;b.find("ul").hide().eq(0).css("display","block");for(b.css({width:d,height:"auto"}).find("li").css("width",d);(a._panelHeight=b.height())>
c.maxHeight;)if(++e<=c.maxColumn)b.css("width",d*e);else{c.maxHeight=b.height();break}a._column=e;a._showWidth=b.css("width")},panelInitWithOptgroup:function(a,b,c){b.find("div."+g.tab+" em").hover(function(){k(this).addClass(g.tabHover)},function(){k(this).removeClass(g.tabHover)}).each(function(b){this.onclick=function(){f.panelTabClick(a,b)}});b.find("> ul").each(function(){f.panelInit(a,this,c)})},panelArrangeWithOptgroup:function(a,b,c){var d=f.borderSize(b),e=k(a).outerWidth()-d.width,h=b.find("> ul");
1>h.length||(a._panelWidth=0,a._panelHeight=0,a._panelTabWidth=0,a._panelTabHeight=0,gridHeight=b.find("li:first").height(),h.each(function(){var d=k(this),f=1;h.hide();d.css("display","block");b.css({width:e,height:"auto"});for(d.find("li").css("width",e);b.height()>c.maxHeight;)if(++f<=c.maxColumn)b.css("width",e*f);else break;a._panelWidth=Math.max(b.width(),a._panelWidth);a._column=Math.max(f,a._column)}),h.each(function(){var d=k(this),f=1;h.hide();d.css("display","block");b.css({width:a._panelWidth,
height:"auto"});for(d.find("li").css("width",e);b.height()>c.maxHeight;)if(++f<=c.maxColumn)b.css("width",e*f);else{c.maxHeight=b.height();break}a._panelHeight=Math.max(b.height(),a._panelHeight)}),a._showWidth=b.css("width"),f.panelActiveSelectedTab(a))},_createDom:function(a,b,c){var d="",e,h="",t;if(c){e=k(a).find("optgroup");for(c=0;c<e.size();c++)h+="<em>"+(e[c].label||index)+"</em>",d+=f._createBlock(e[c]);0<k(a).find("> option").size()&&(h+="<em>"+b.grouplessLabel+"</em>",d+=f._createBlock(a));
h='<div class="'+g.tab+'">'+h+"</div>"}else d=f._createBlock(a,!0);c=a.id?' id="'+a.id+'" ':"";e=a.name?' name="'+a.name+'" ':"";t=a.getAttribute("title")?' title="'+a.getAttribute("title")+'" ':"";b=b.styleString?' style="'+b.styleString+'" ':"";k(a).after('<a href="javascript:;" class="'+g.select+'" id="__'+g.select+u+'"'+t+b+'><input type="hidden" '+c+e+' value="" /><em></em><i class="icon-chevron-down"></i></a>');k("body:first").append('<div class="'+g.panel+'" id="__'+g.select+u+'panel" style="display:none">'+
h+d+"</div>");return k(m.getElementById("__"+g.select+u++))},_createBlock:function(a,b){var c="",d=k(a).find("> option"),e;for(e=0;e<d.length;e++)r(d[e].text)&&(d[e].text=d[e].value),c+='<li><a href="javascript:;" rel="'+d[e].value+'">'+d[e].text+"</a></li>";"undefined"!=typeof b&&(b&&1==d.length)&&(c+="<li>&nbsp;</li>");return"<ul>"+c+"</ul>"},setValue:function(a){var b,c,d=null,e=k(this);f.options(this);var h=this._panel.find("a");if(this._multiple){var t=[],m=[];for(b=0;b<h.length;b++)c=h[b],r(c.rel)||
c.rel!=a||(c.className=c.className==g.linkOn?"":g.linkOn),c.className==g.linkOn&&(t.push(c.innerHTML),m.push(c.rel));a=d="";0<m.length&&(d=t.join(","),a=m.join(l.multipleJointer))}else{h.removeClass(g.linkOn);for(b=0;b<h.length;b++)c=h[b],r(c.rel)||c.rel!=a||(c.className=g.linkOn,d=c.innerHTML);null===d&&0<h.length&&(a=h[0].rel,d=h[0].innerHTML)}this._caption.html(d);this._value.val(a).attr("rel",d);this._caption.width()+26>this._selectWidth&&e.width(this._caption.width()+26);this._caption.width()+
26<this._selectWidth&&e.width(this._selectWidth);if(this._group){var p={};this._tab.find("em").css("text-decoration","none");this._panel.find("a."+g.linkOn).each(function(){p[k(this).parent().parent().index()-1]=1});for(b in p)this._tab.find("em:eq("+b+")").css("text-decoration","underline")}},selectClick:function(a){f.haltEvent(a);f.hideAll();f.show.call(this)},itemClick:function(a,b,c){var d=f.options(this),e=b!=this._value.val();this._multiple||f.hideAll();f.setValue.call(this,b);if(q(d.click)||
e&&q(d.change))c||f.haltEvent(a),q(d.click)&&d.click.call(this._value,a,b),e&&q(d.change)&&d.change.call(this._value,a,b)},clickValue:function(a){0<this._panel.find("a[rel='"+a+"']").length&&(f.itemClick.call(this,n.event,a,!0),this._tab&&f.panelActiveSelectedTab(this))},panelTabClick:function(a,b){a._panel.find("div."+g.tab).find("em").removeClass(g.tabOn).eq(b).addClass(g.tabOn);a._panel.find("> ul").hide().eq(b).show();a._panel.css({width:a._panelWidth,height:a._panelHeight})},panelActiveSelectedTab:function(a){var b,
c=a._panel.find("> ul");for(b=0;b<c.length&&!(0<c.eq(b).find("a."+g.linkOn).length);b++);b>=c.length&&(b=0);c.hide().eq(b).show();a._tab.find("em").removeClass(g.tabOn).eq(b).addClass(g.tabOn)},panelPosition:function(a,b,c,d){var e=0,h=0,g=0,l=0;self.innerHeight?(l=self.innerHeight,g=self.innerWidth,e=self.pageXOffset,h=self.pageYOffset):z?(l=m.documentElement.clientHeight,g=m.documentElement.clientWidth,h=m.documentElement.scrollTop,e=m.documentElement.scrollLeft):m.body&&(l=m.body.clientHeight,
g=m.body.clientWidth,e=m.body.scrollLeft,h=m.body.scrollTop);var p=k(a);c=f.options(a);var n,q;n=f.borderSize(b);q=parseInt(a._showWidth);a=Math.min(a._panelHeight,c.maxHeight);b=d?b.offset().left:p.offset().left;switch(c.direction){case "top":d=p.offset().top+p.outerHeight()-a-n.height;break;case "bottom":d=p.offset().top;break;default:d=p.offset().top+(p.outerHeight()>>1)-(a>>1)-(n.height>>1)}d<h+c.maxTop&&(d=p.offset().top);d+a>h+l&&(d=p.offset().top+p.outerHeight()-a-n.height);d+a>h+l&&(d=h+l-
a-n.height);b+q>e+g&&(b=e+g-q-n.width);0>b&&(b=0);0>d&&(d=c.maxTop);return{x:b,y:d,w:q,h:a}},show:function(){var a=this,b=k(a),c=f.options(a),d,e=a._panel,h,g;b.blur();e.is(":visible")||(d=f.borderSize(e),e.show().css({height:b.outerHeight()-d.height,left:b.offset().left,top:b.offset().top}),a._group&&e.css("width",a._panelWidth),h=f.panelPosition(a,e,c,!0),g={height:h.h,left:h.x,top:h.y},1<a._column&&(g.width=a._showWidth,e.css("width",b.outerWidth())),"top"==c.direction&&e.css("top",b.offset().top+
1),a._panel.animate(g,l.speed,function(){q(c.show)&&c.show.call(a)}),l.shadow&&v.show().css({width:e.width(),height:b.outerHeight()-d.height,left:b.offset().left,top:b.offset().top}).animate({height:h.h,left:h.x+6,top:h.y+6},l.speed),s.push(a))},hide:function(){var a=this,b=f.options(a),c=k(this),d=this._panel,e=f.borderSize(d),g;g=d.css("z-index");d.css("z-index",g-1);"top"==b.direction&&d.css("top",parseInt(d.css("top"))+1);e={height:c.outerHeight()-e.height,left:c.offset().left,top:c.offset().top};
1<a._column&&(e.width=c.outerWidth());d.animate(e,l.speed,function(){d.hide();d.css("z-index",g);q(b.hide)&&b.hide.call(a)});l.shadow&&v.hide()},hideAll:function(){for(var a;a=s.pop();)f.hide.call(a)},reset:function(a,b){var c=this._panel,d=f.options(this),e="",g,k=0;this._initSelectedIndex=-1;d.maxHeight=this._origMaxHeight;r(b)||(d.selectedValue=b);for(g in a)e+='<li><a href="javascript:;" rel="'+g+'">'+a[g]+"</a></li>",k++;1==k&&(e+="<li>&nbsp;</li>");c.empty().html("<ul>"+e+"</ul>");f.panelInit(this,
c,d);f.panelArrange(this,c,d);f.setValue.call(this,d.selectedValue)},haltEvent:function(a){a=a||n.event;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;return!1},borderSize:function(a){a=k(a);return{width:parseInt(a.css("border-left-width"))+parseInt(a.css("border-right-width")),height:parseInt(a.css("border-top-width"))+parseInt(a.css("border-bottom-width"))}},options:function(a){return a._options?a._options:{}},value:function(){return this._value?this._value.val():this.value},caption:function(){return this._value?
this._value[0].getAttribute("rel"):this.getAttribute("rel")}};k.vselect={config:function(a){return"undefined"==typeof l[a]?void 0:l[a]},setConfig:function(a,b){switch(typeof a){case "object":for(var c in a)l[c]=a[c];return;case "array":for(c=0;c<a.length;c++)l[c]=a[c];return}l[a]=b},style:function(a){return"undefined"==typeof g[a]?void 0:g[a]},setStyle:function(a,b){switch(typeof a){case "object":for(var c in a)g[c]=a[c];return;case "array":for(c=0;c<a.length;c++)g[c]=a[c];return}g[a]=b},hide:f.hideAll};
k.fn.extend({vselect:function(){return f.init.apply(this,arguments)},vselectShow:function(){var a=arguments;return this.each(function(){f.show.apply(this._panel?this:k(this).parent()[0],a)})},vselectHide:function(){var a=arguments;return this.each(function(){f.hide.apply(this._panel?this:k(this).parent()[0],a)})},vselectValue:function(){return 1>this.size()?null:f.value.apply(this[0])},vselectSetValue:function(a){return 1>this.size()?null:f.setValue.call(this.parent()[0],a)},vselectClickValue:function(a){return 1>
this.size()?null:f.clickValue.call(this.parent()[0],a)},vselectCaption:function(){return 1>this.size()?null:f.caption.call(this[0])},vselectReset:function(){var a=arguments;return this.each(function(){f.reset.apply(this._panel?this:k(this).parent()[0],a)})}})})(jQuery,document,window);
